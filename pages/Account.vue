<template>
	<section id="account" class="flex-nowrap flex section">
    <!-- ---------------------------------------------------------------- -->
    <!-- 02. Page Tabs  -->
    <!-- ---------------------------------------------------------------- -->
    <div class="pd-medium menu-tabs">
     <p class="mn-medium t-semi p-medium">Личный кабинет   <TestButton></TestButton></p>

      <button @click="changeTab('user')" :class="{'product-tab-active':data.currentTab === 'user'}" 
      class="product-tab">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M8.75 7C8.75 5.20507 10.2051 3.75 12 3.75C13.7949 3.75 15.25 5.20507 15.25 7C15.25 8.79493 13.7949 10.25 12 10.25C10.2051 10.25 8.75 8.79493 8.75 7ZM12 2.25C9.37665 2.25 7.25 4.37665 7.25 7C7.25 9.62335 9.37665 11.75 12 11.75C14.6234 11.75 16.75 9.62335 16.75 7C16.75 4.37665 14.6234 2.25 12 2.25ZM5.75 19C5.75 17.2051 7.20507 15.75 9 15.75H15C16.7949 15.75 18.25 17.2051 18.25 19C18.25 19.6904 17.6904 20.25 17 20.25H7C6.30964 20.25 5.75 19.6904 5.75 19ZM9 14.25C6.37665 14.25 4.25 16.3766 4.25 19C4.25 20.5188 5.48122 21.75 7 21.75H17C18.5188 21.75 19.75 20.5188 19.75 19C19.75 16.3766 17.6234 14.25 15 14.25H9Z" fill="#242424"/>
        </svg>
        Мои данные
      </button>

      <button @click="changeTab('favorites')" :class="{'product-tab-active':data.currentTab === 'favorites'}" 
      class="product-tab ">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M10.4398 6.97513C8.88285 5.38284 6.32087 5.38284 4.76396 6.97513C3.25576 8.51761 3.25576 10.9823 4.76396 12.5248L11.8631 19.7853C11.9392 19.8631 12.0645 19.8631 12.1406 19.7853L19.2398 12.5248C20.748 10.9823 20.748 8.51761 19.2398 6.97513C17.6828 5.38284 15.1209 5.38284 13.564 6.97513L12.5381 8.0243C12.397 8.16861 12.2037 8.24996 12.0019 8.24996C11.8 8.24996 11.6067 8.16861 11.4656 8.0243L10.4398 6.97513ZM3.69145 5.92645C5.83675 3.7324 9.36697 3.7324 11.5123 5.92645L12.0019 6.42718L12.4915 5.92645C14.6367 3.7324 18.167 3.7324 20.3123 5.92645C22.3904 8.05187 22.3904 11.448 20.3123 13.5735L13.2131 20.834C12.5486 21.5136 11.4551 21.5136 10.7906 20.834L3.69145 13.5735C1.61326 11.448 1.61327 8.05187 3.69145 5.92645Z" fill="#242424"/>
        </svg>
        Избранное
      </button>
      <button @click="changeTab('history')" :class="{'product-tab-active':data.currentTab === 'history'}" 
      class="product-tab">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M6.8 2.25006H6.7679H6.76789C5.95505 2.25005 5.29944 2.25005 4.76853 2.29342C4.2219 2.33809 3.74175 2.43245 3.29754 2.65879C2.59193 3.01831 2.01825 3.59199 1.65873 4.2976C1.43239 4.74182 1.33803 5.22196 1.29336 5.76859C1.24999 6.2995 1.24999 6.9551 1.25 7.76793V7.76796V7.80006V8.00006C1.25 8.41428 1.58579 8.75006 2 8.75006C2.41421 8.75006 2.75 8.41428 2.75 8.00006V7.80006C2.75 6.94761 2.75058 6.35337 2.78838 5.89074C2.82547 5.43687 2.8946 5.1761 2.99524 4.97858C3.21095 4.55522 3.55516 4.21101 3.97852 3.9953C4.17604 3.89466 4.43681 3.82553 4.89068 3.78844C5.35331 3.75064 5.94755 3.75006 6.8 3.75006H7C7.41421 3.75006 7.75 3.41427 7.75 3.00006C7.75 2.58585 7.41421 2.25006 7 2.25006H6.8ZM17.2 3.75006C18.0525 3.75006 18.6467 3.75064 19.1093 3.78844C19.5632 3.82553 19.824 3.89466 20.0215 3.9953C20.4448 4.21101 20.789 4.55522 21.0048 4.97858C21.1054 5.1761 21.1745 5.43687 21.2116 5.89074C21.2494 6.35337 21.25 6.94761 21.25 7.80006V8.00006C21.25 8.41428 21.5858 8.75006 22 8.75006C22.4142 8.75006 22.75 8.41428 22.75 8.00006V7.80006V7.76794C22.75 6.95511 22.75 6.2995 22.7066 5.76859C22.662 5.22196 22.5676 4.74182 22.3413 4.2976C21.9817 3.59199 21.4081 3.01831 20.7025 2.65879C20.2582 2.43245 19.7781 2.33809 19.2315 2.29342C18.7006 2.25005 18.0449 2.25005 17.2321 2.25006H17.2321H17.2H17C16.5858 2.25006 16.25 2.58585 16.25 3.00006C16.25 3.41427 16.5858 3.75006 17 3.75006H17.2ZM2.75 16.0001C2.75 15.5858 2.41421 15.2501 2 15.2501C1.58579 15.2501 1.25 15.5858 1.25 16.0001V16.2001V16.2322V16.2322C1.24999 17.045 1.24999 17.7006 1.29336 18.2315C1.33803 18.7782 1.43239 19.2583 1.65873 19.7025C2.01825 20.4081 2.59193 20.9818 3.29754 21.3413C3.74175 21.5677 4.2219 21.662 4.76853 21.7067C5.29944 21.7501 5.95505 21.7501 6.76788 21.7501H6.8H7C7.41421 21.7501 7.75 21.4143 7.75 21.0001C7.75 20.5858 7.41421 20.2501 7 20.2501H6.8C5.94755 20.2501 5.35331 20.2495 4.89068 20.2117C4.43681 20.1746 4.17604 20.1055 3.97852 20.0048C3.55516 19.7891 3.21095 19.4449 2.99524 19.0215C2.8946 18.824 2.82547 18.5633 2.78838 18.1094C2.75058 17.6468 2.75 17.0525 2.75 16.2001V16.0001ZM22.75 16.0001C22.75 15.5858 22.4142 15.2501 22 15.2501C21.5858 15.2501 21.25 15.5858 21.25 16.0001V16.2001C21.25 17.0525 21.2494 17.6468 21.2116 18.1094C21.1745 18.5633 21.1054 18.824 21.0048 19.0215C20.789 19.4449 20.4448 19.7891 20.0215 20.0048C19.824 20.1055 19.5632 20.1746 19.1093 20.2117C18.6467 20.2495 18.0525 20.2501 17.2 20.2501H17C16.5858 20.2501 16.25 20.5858 16.25 21.0001C16.25 21.4143 16.5858 21.7501 17 21.7501H17.2H17.2321C18.045 21.7501 18.7006 21.7501 19.2315 21.7067C19.7781 21.662 20.2582 21.5677 20.7025 21.3413C21.4081 20.9818 21.9817 20.4081 22.3413 19.7025C22.5676 19.2583 22.662 18.7782 22.7066 18.2315C22.75 17.7006 22.75 17.045 22.75 16.2322V16.2001V16.0001ZM9.16957 6.25006L9.2 6.25006L14.8 6.25006L14.8304 6.25006C15.3646 6.25005 15.8104 6.25004 16.1747 6.2798C16.5546 6.31084 16.9112 6.37795 17.2485 6.54979C17.7659 6.81345 18.1866 7.23414 18.4503 7.75159C18.6221 8.08885 18.6892 8.44551 18.7203 8.82539C18.75 9.18962 18.75 9.63546 18.75 10.1696V10.2001V11.0001V13.8001V13.8305C18.75 14.3647 18.75 14.8105 18.7203 15.1747C18.6892 15.5546 18.6221 15.9113 18.4503 16.2485C18.1866 16.766 17.7659 17.1867 17.2485 17.4503C16.9112 17.6222 16.5546 17.6893 16.1747 17.7203C15.8104 17.7501 15.3646 17.7501 14.8304 17.7501H14.8304H14.8H9.2H9.16959H9.16955C8.6354 17.7501 8.18956 17.7501 7.82533 17.7203C7.44545 17.6893 7.08879 17.6222 6.75153 17.4503C6.23408 17.1867 5.81338 16.766 5.54973 16.2485C5.37789 15.9113 5.31078 15.5546 5.27974 15.1747C5.24998 14.8105 5.24999 14.3646 5.25 13.8305L5.25 13.8001L5.25 11.0001V10.2001L5.25 10.1696C5.24999 9.63547 5.24998 9.18962 5.27974 8.82539C5.31078 8.44551 5.37789 8.08885 5.54973 7.75159C5.81338 7.23414 6.23408 6.81345 6.75153 6.54979C7.08879 6.37795 7.44545 6.31084 7.82533 6.2798C8.18956 6.25004 8.63541 6.25005 9.16957 6.25006ZM17.25 10.2001V10.2501L6.75 10.2501V10.2001C6.75 9.62763 6.75058 9.24342 6.77476 8.94754C6.79822 8.66042 6.8401 8.52313 6.88624 8.43257C7.00608 8.19737 7.19731 8.00614 7.43251 7.8863C7.52307 7.84016 7.66035 7.79828 7.94748 7.77482C8.24336 7.75064 8.62757 7.75006 9.2 7.75006L14.8 7.75006C15.3724 7.75006 15.7566 7.75064 16.0525 7.77482C16.3396 7.79828 16.4769 7.84016 16.5675 7.8863C16.8027 8.00614 16.9939 8.19737 17.1138 8.43257C17.1599 8.52313 17.2018 8.66042 17.2252 8.94754C17.2494 9.24342 17.25 9.62763 17.25 10.2001ZM17.25 11.7501L6.75 11.7501V13.8001C6.75 14.3725 6.75058 14.7567 6.77476 15.0526C6.79822 15.3397 6.8401 15.477 6.88624 15.5675C7.00608 15.8028 7.19731 15.994 7.43251 16.1138C7.52307 16.16 7.66035 16.2018 7.94748 16.2253C8.24336 16.2495 8.62757 16.2501 9.2 16.2501H14.8C15.3724 16.2501 15.7566 16.2495 16.0525 16.2253C16.3396 16.2018 16.4769 16.16 16.5675 16.1138C16.8027 15.994 16.9939 15.8028 17.1138 15.5675C17.1599 15.477 17.2018 15.3397 17.2252 15.0526C17.2494 14.7567 17.25 14.3725 17.25 13.8001V11.7501Z" fill="#242424"/>
        </svg>
        История заказов
      </button>
      <button @click="changeTab('bonus')" :class="{'product-tab-active':data.currentTab === 'bonus'}" 
      class="mn-semi product-tab">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M15.5 2.75C16.4665 2.75 17.25 3.5335 17.25 4.5C17.25 5.4665 16.4665 6.25 15.5 6.25L13.008 6.25L13.6667 4.05432C13.899 3.28016 14.6115 2.75 15.4198 2.75H15.5ZM18.75 4.5C18.75 5.14432 18.5625 5.74485 18.2391 6.25H20C20.9665 6.25 21.75 7.0335 21.75 8V10C21.75 10.9665 20.9665 11.75 20 11.75H19.75L19.75 19C19.75 20.5188 18.5188 21.75 17 21.75H12H7C5.48122 21.75 4.25 20.5188 4.25 19L4.25 11.75H4C3.0335 11.75 2.25 10.9665 2.25 10V8C2.25 7.0335 3.0335 6.25 4 6.25H5.76091C5.4375 5.74485 5.25 5.14432 5.25 4.5C5.25 2.70507 6.70507 1.25 8.5 1.25H8.58023C10.0509 1.25 11.3474 2.21466 11.77 3.6233L12 4.38992L12.23 3.6233C12.6526 2.21466 13.9491 1.25 15.4198 1.25H15.5C17.2949 1.25 18.75 2.70507 18.75 4.5ZM5 10.25L11.25 10.25L11.25 7.75H8.5L4 7.75C3.86193 7.75 3.75 7.86193 3.75 8V10C3.75 10.1381 3.86193 10.25 4 10.25H5ZM12.75 10.25H19H20C20.1381 10.25 20.25 10.1381 20.25 10V8C20.25 7.86193 20.1381 7.75 20 7.75H15.5L12.75 7.75L12.75 10.25ZM5.75 11.75V19C5.75 19.6904 6.30964 20.25 7 20.25H11.25V11.75L5.75 11.75ZM12.75 11.75V20.25H17C17.6904 20.25 18.25 19.6904 18.25 19V11.75H12.75ZM10.992 6.25L10.3333 4.05432C10.101 3.28016 9.38847 2.75 8.58023 2.75H8.5C7.5335 2.75 6.75 3.5335 6.75 4.5C6.75 5.4665 7.5335 6.25 8.5 6.25H10.992Z" fill="#242424"/>
        </svg>
        Бонусная система
      </button>

       <button @click="logout()" class="w-100 button">Выйти</button>
    </div>
    

    <div class="account-view">
      <User  v-if="data.currentTab === 'user'" :user="user"/>
      <Favorites  v-if="data.currentTab === 'favorites'" :favorites="favorites"/>
      <History  v-if="data.currentTab === 'history'"  :user="user"/>
      <Bonus  v-if="data.currentTab === 'bonus'"/>
   
    </div>


 
  </section>
</template>


<script setup>
import User from '@/components/client/sections/account/User.vue';
import Favorites from '@/components/client/sections/account/Favorites.vue';
import History from '@/components/client/sections/account/History.vue';
import Bonus from '@/components/client/sections/account/Bonus.vue';



import { computed, onMounted,reactive,toRefs } from 'vue'
import { useStore } from 'vuex'
import { useRoute,useRouter } from 'vue-router'

const store = useStore()
const route = useRoute()
const router = useRouter()
if (store.state.products.all.length < 1) await store.dispatch('products/fetchProductsPublished')
store.dispatch('users/fetchUser', store.state.users.current.phone)

const user = computed(() => store.state.users.current)

const favorites = computed(() => store.state.favorites.items.map(({ id}) => {
    const product = store.state.products.all.find(product => product.id === id) 
    return {
      images: product.images,
      name: product.name,
      price: product.price,
      id: product.id,
      modifications: product.modifications,
    }
  }))
// Making tabs working
let data = reactive({currentTab: 'user'})
let reactiveData = toRefs(data)
function changeTab (tab) {data.currentTab = tab; console.log(data.currentTab) }

function logout() {
  router.push({ name: 'Catalog'}).then(() => {
    store.dispatch("auth/logout")
  })
}

</script>

<style lang="scss">
.menu-tabs {

  min-width: 16rem;
  height: min-content;
   
  border-radius: 1rem;
  margin-right: 2rem;
  background: #F7F7F7;

  .product-tab {
    display: flex;
    align-items: center;
    justify-content: flex-start;



    background: transparent;

    text-align: left;

    padding: 0.5rem;
    border-radius: 0.5rem;
    width: 100%;

    svg { opacity: 0.33; margin-right: 1rem; }

    &:hover {
      cursor: pointer;
    }
    
    &-active {
      color: #00ff88;
      background: white;

      svg { opacity: 1; path { fill: #00ff88;}  }
    }

  }
 }
 
#account {
 

 .account-view {
  width: 100%;
 }
}
</style>
